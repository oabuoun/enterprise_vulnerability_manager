import mysql.connector as mysql
import config

HOST = config.HOST
USER = config.USER
PASSWD = config.PASSWD
DATABASE = config.DATABASE

def init():
    
    database_exists = False
    table_exists = False

    conn = mysql.connect(host=HOST, user=USER, password=PASSWD)

    cursor = conn.cursor()
    cursor.execute("SHOW DATABASES")
    for i in cursor:
        print(i)
        if 'cve_data' in i:
            database_exists = True
            print("Database found")
    if database_exists == False:
        cursor.execute("CREATE DATABASE cve_data")
        print("Database created")

    print("----------------------------------------")
    conn.close()

    conn = mysql.connect(host=HOST, user=USER, password=PASSWD, database=DATABASE)
    cursor = conn.cursor()
    cursor.execute("SHOW TABLES")
    for j in cursor:
        print(j)
        if 'cves' in j:
            table_exists = True
            print("Table found")

    if table_exists == False:
        cursor.execute("CREATE TABLE cves (cve_id VARCHAR(20) PRIMARY KEY, description TEXT, cvss_score FLOAT, last_modified TEXT)")
        print("Table created")
        print("-----------------------------------------------")
    conn.close()

def insert_values(id, desc, score, last):
    init()
    conn = mysql.connect(host=HOST, user=USER, password=PASSWD, database=DATABASE)
    cursor = conn.cursor()
    cursor.execute("INSERT INTO cves (cve_id, description, cvss_score, last_modified) VALUES (%s, %s, %s, %s);", (id, desc, score, last))
    conn.commit()
    cursor.execute("SELECT * FROM cves")
    rows = cursor.fetchall()
    for x in rows:
        print(x)

if __name__ == '__main__':
    insert_values("CVE-2021-39224", "A potential security vulnerability has been identified for the HP OfficeJet 7110 Wide Format ePrinter that enables Cross-Site Scripting (XSS).", 5.3, "2021-10-29")