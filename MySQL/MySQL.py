import mysql.connector as mysql
import config

HOST = config.HOST
USER = config.USER
PASSWD = config.PASSWD
DATABASE = config.DATABASE

def init():
    database_exists = False
    table_exists = False
    conn = mysql.connect(host=HOST, user=USER, password=PASSWD)

    cursor = conn.cursor()
    cursor.execute("SHOW DATABASES")
    for i in cursor:
        print(i)
        if 'cve_data' in i:
            database_exists = True
            print("Database found")
    if database_exists == False:
        cursor.execute("CREATE DATABASE cve_data")
        print("Database created")
    print("----------------------------------------")
    conn.close()

    conn = mysql.connect(host=HOST, user=USER, password=PASSWD, database=DATABASE)
    cursor = conn.cursor()
    cursor.execute("SHOW TABLES")
    for j in cursor:
        print(j)
        if 'cves' in j:
            table_exists = True
            print("Table found")

    if table_exists == False:
        cursor.execute("CREATE TABLE cves (cve_id VARCHAR(20) PRIMARY KEY, description TEXT, cvss_score TEXT, last_modified TEXT)")
        print("Table created")
        print("-----------------------------------------------")
    conn.close()

def insert_values(records):
    init()
    conn = mysql.connect(host=HOST, user=USER, password=PASSWD, database=DATABASE)
    cursor = conn.cursor()
    for key in records.keys():
        id = key
        desc = records[key][0]
        score = records[key][1]
        last = records[key][2]
        cursor.execute("INSERT INTO cves (cve_id, description, cvss_score, last_modified) VALUES (%s, %s, %s, %s);", (id, desc, score, last))
        conn.commit()
    cursor.execute("SELECT * FROM cves")
    rows = cursor.fetchall()
    for x in rows:
        print(x)

if __name__ == '__main__':
<<<<<<< HEAD
    dupe_check({'CVE-2021-1123': ['NVIDIA vGPU software contains a vulnerability in the Virtual GPU Manager (vGPU plugin), where it can deadlock, which may lead to denial of service.', 'No CVSS score found', '2021-10-29T20:41Z'], 'CVE-2021-1122': ['NVIDIA vGPU software contains a vulnerability in the Virtual GPU Manager (vGPU plugin), where it can dereference a NULL pointer, which may lead to denial of service.', 'No CVSS score found', '2021-10-29T20:41Z'], 'CVE-2021-1121': ['NVIDIA vGPU software contains a vulnerability in the Virtual GPU Manager kernel driver, where a vGPU can cause resource starvation among other vGPUs hosted on the same GPU, which may lead to denial of service.', 'No CVSS score found', '2021-10-29T20:41Z'], 'CVE-2021-1120': ['NVIDIA vGPU software contains a vulnerability in the Virtual GPU Manager (vGPU plugin), where a string provided by the guest OS may not be properly null terminated. The guest OS or attacker has no ability to push content to the plugin through this vulnerability, which may lead to information disclosure, data tampering, unauthorized code execution, and denial of service.', 'No CVSS score found', '2021-10-29T20:41Z'], 'CVE-2021-1119': ['NVIDIA vGPU software contains a vulnerability in the Virtual GPU Manager (vGPU plugin), where it can double-free a pointer, which may lead to denial of service. This flaw may result in a write-what-where condition, allowing an attacker to execute arbitrary code impacting integrity and availability.', 'No CVSS score found', '2021-10-29T20:41Z'], 'CVE-2021-1118': ['NVIDIA vGPU software contains a vulnerability in the Virtual GPU Manager (vGPU plugin), where there is the potential to execute privileged operations by the guest OS, which may lead to information disclosure, data tampering, escalation of privileges, and denial of service', 'No CVSS score found', '2021-10-29T20:41Z'], 'CVE-2021-1116': ['NVIDIA GPU Display Driver for Windows contains a vulnerability in the kernel mode layer (nvlddmkm.sys), where a NULL pointer dereference in the kernel, created within user mode code, may lead to a denial of service in the form of a system crash.', 5.5, '2021-10-28T20:42Z'], 'CVE-2021-1115': ['NVIDIA GPU Display Driver for Windows contains a vulnerability in the kernel mode layer (nvlddmkm.sys) handler for private IOCTLs, where an attacker with local unprivileged system access may cause a NULL pointer dereference, which may lead to denial of service in a component beyond the vulnerable component.', 6.5, '2021-10-28T20:41Z']})
    """conn = mysql.connect(host=HOST, user=USER, password=PASSWD)
    if conn.is_connected():
        print("Connection made")
    else:
        print("Connection failed")
    conn.close()"""
=======
    insert_values({'CVE-2021-1123': ['NVIDIA vGPU software contains a vulnerability in the Virtual GPU Manager (vGPU plugin), where it can deadlock, which may lead to denial of service.', 'No CVSS score found', '2021-10-29T20:41Z'], 'CVE-2021-1122': ['NVIDIA vGPU software contains a vulnerability in the Virtual GPU Manager (vGPU plugin), where it can dereference a NULL pointer, which may lead to denial of service.', 'No CVSS score found', '2021-10-29T20:41Z'], 'CVE-2021-1121': ['NVIDIA vGPU software contains a vulnerability in the Virtual GPU Manager kernel driver, where a vGPU can cause resource starvation among other vGPUs hosted on the same GPU, which may lead to denial of service.', 'No CVSS score found', '2021-10-29T20:41Z'], 'CVE-2021-1120': ['NVIDIA vGPU software contains a vulnerability in the Virtual GPU Manager (vGPU plugin), where a string provided by the guest OS may not be properly null terminated. The guest OS or attacker has no ability to push content to the plugin through this vulnerability, which may lead to information disclosure, data tampering, unauthorized code execution, and denial of service.', 'No CVSS score found', '2021-10-29T20:41Z'], 'CVE-2021-1119': ['NVIDIA vGPU software contains a vulnerability in the Virtual GPU Manager (vGPU plugin), where it can double-free a pointer, which may lead to denial of service. This flaw may result in a write-what-where condition, allowing an attacker to execute arbitrary code impacting integrity and availability.', 'No CVSS score found', '2021-10-29T20:41Z'], 'CVE-2021-1118': ['NVIDIA vGPU software contains a vulnerability in the Virtual GPU Manager (vGPU plugin), where there is the potential to execute privileged operations by the guest OS, which may lead to information disclosure, data tampering, escalation of privileges, and denial of service', 'No CVSS score found', '2021-10-29T20:41Z'], 'CVE-2021-1116': ['NVIDIA GPU Display Driver for Windows contains a vulnerability in the kernel mode layer (nvlddmkm.sys), where a NULL pointer dereference in the kernel, created within user mode code, may lead to a denial of service in the form of a system crash.', 5.5, '2021-10-28T20:42Z'], 'CVE-2021-1115': ['NVIDIA GPU Display Driver for Windows contains a vulnerability in the kernel mode layer (nvlddmkm.sys) handler for private IOCTLs, where an attacker with local unprivileged system access may cause a NULL pointer dereference, which may lead to denial of service in a component beyond the vulnerable component.', 6.5, '2021-10-28T20:41Z']})
>>>>>>> 352d7bad15531256bea9c2b9fbd9fd0b6232cc8d
