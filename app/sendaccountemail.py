import yagmail
import random
import re

def passgen():
    char_lower= "abcdefghijklmnopqrstuvwxyz"
    char_upper = "ABCDEFGHIJKLMNOPQRSTUVWXYZ"
    sym = "!@$%^&*()-_=+[{}]|<,.>/?"
    num = "123456789"
    #Below are the required lengths and number of special characters in the generated password.

    required_char_lower=2
    required_char_upper=2
    required_char_sym=2
    required_char_num=2

    while True:
        password_len = 16
        password = ""
        if required_char_lower > 0:
            for x in range(0,required_char_lower):
                password = password + random.choice(char_lower)
        if required_char_upper > 0:
            for x in range(0,required_char_upper):
                password = password + random.choice(char_upper)
        if required_char_sym > 0:
            for x in range(0,required_char_sym):
                password = password + random.choice(sym)
        if required_char_num > 0:
            for x in range(0,required_char_num):
                password = password + random.choice(num)

        password_len = password_len - required_char_lower - required_char_upper - required_char_num - required_char_sym
#Below will randomise the order of the uppercase lowercase symbols and numbers
        for x in range(0,password_len):
            randomiser = random.randint(1,4)
            if randomiser == 1:
                password = password + random.choice(char_lower)
            elif randomiser == 2:
                password = password + random.choice(char_upper)
            elif randomiser == 3:
                password = password + random.choice(sym)
            elif randomiser == 4:
                password = password + random.choice(num)
#Below will join the different items together randomly to form one string.
        password = ''.join(random.sample(password, len(password)))
        return password
        # uservalid = infocheck.compare(userinfo, password)
        # listvalid = gencheck.list_check(password)
        # if listvalid != 1 and uservalid != 1:
        #     return password
def validemail(email):
    regex = r'\b[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Z|a-z]{2,}\b'
    if(re.fullmatch(regex, email)):
        return True
    else:
        return False

def gomail(recipientemail, recipient):
    receiver = recipientemail
    is_valid = validemail(receiver)
    if is_valid == True:
        newpass = passgen()
        body = [
        f"Hello {recipient},",
        "Here is you gold star and randomly generated password!",
        f"Username = {receiver}",
        f"Password = {newpass}",
        "I hope you enjoy!"
        ]
        filename = "goldstar.jpg"
        #with open('app/templates/email.html', 'r') as f:
            #html_string = f.read()

        try:
            yag = yagmail.SMTP("sparta.vulnad@gmail.com", 'bBV:`T4qJwL}}&5H')
            yag.send(
                to=receiver,
                subject="Receiving your gold star",
                #contents=html_string,
                contents=body,
                attachments=filename,
            )
            return ("Email Sent")

        except:
            return ("Email Failed to Send")
    else:
        return ("Email is invalid")
