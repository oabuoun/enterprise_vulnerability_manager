import mysql.connector
from sql_init import ProjectDB
mydb=ProjectDB()
mycursor = mydb.cursor

#class ProjectCommands:
def create_database(self):
    mycursor.execute("CREATE DATABASE projects;")
    mydb.connection.commit()

def create_table(self):
     mycursor.execute("CREATE TABLE projecttable (id INT AUTO_INCREMENT PRIMARY KEY, project VARCHAR(255), product VARCHAR(255), username VARCHAR(255));")
     mydb.connection.commit()

def init_project():
    database_exists = False
    table_exists = False
    # conn = mysql.connect(host=HOST, user=USER, password=PASSWD)
    #
    # cursor = conn.cursor()
    mycursor.execute("SHOW DATABASES")
    for i in cursor:
        print(i)
        if 'projects' in i:
            database_exists = True
            print("Database found")
    if database_exists == False:
        mycursor.execute("CREATE DATABASE projects")
        print("Database created")
    print("----------------------------------------")
    #conn.close()

    # conn = mysql.connect(host=HOST, user=USER, password=PASSWD, database=DATABASE)
    # cursor = conn.cursor()
    mycursor.execute("SHOW TABLES")
    for j in cursor:
        print(j)
        if 'projecttable' in j:
            table_exists = True
            print("Table found")

    if table_exists == False:
        mycursor.execute("CREATE TABLE projecttable (id INT AUTO_INCREMENT PRIMARY KEY, project VARCHAR(255), product VARCHAR(255), username VARCHAR(255));")
        print("Table created")
        print("-----------------------------------------------")
    #conn.close()
    return

def add_data(project,product,username):
    mycursor.execute(f"INSERT INTO projecttable (project, username) VALUES ('{project}','{username}');")
    mydb.connection.commit()
    mycursor.execute(f"INSERT INTO projecttable (project, product, username) VALUES ('{project}','{product}','{username}');")
    mydb.connection.commit()

def delete_project(project, username):
    mycursor.execute(f"DELETE FROM projecttable WHERE project = '{project}' AND username = {username};")
    mydb.connection.commit()
    mycursor.execute(f"DELETE FROM underlings WHERE project = '{project}';")
    mydb.connection.commit()

def delete_product(project,product,username):
    mycursor.execute(f"DELETE FROM projecttable WHERE project = '{project}' AND product = '{product}' AND username = {username};")
    mydb.connection.commit()

def delete_table(self):
    mycursor.execute(f"DROP TABLE projecttable ;")
    mydb.connection.commit()

def get_projects_names(user):
    mycursor.execute(f"SELECT project FROM projecttable where username = '{user}';")
    data = mycursor.fetchall()
    print(data)
    list = []
    for i in data:
        check = i[0]
        print(check)
        if check not in list:
            list.append(check)
    return list

def get_projects_from_product(product):
    mycursor.execute(f"SELECT project FROM projecttable where product = '{product}';")
    data = mycursor.fetchall()
    list = []
    for i in data:
        list.append(i)
    return list

def get_username_from_product(product):
    mycursor.execute(f"SELECT username FROM projecttable where product = '{product}';")
    data = mycursor.fetchall()
    list = []
    for i in data:
        list.append(i)
    return list

def get_products():
    mycursor.execute(f"SELECT product FROM projecttable;")
    data = mycursor.fetchall()
    list = []
    for i in data:
        list.append(i[0])
    return list

def get_products_from_projects(project):
    mycursor.execute(f"SELECT product FROM projecttable where project = '{project}';")
    data = mycursor.fetchall()
    list = []
    strval = ''
    for i in data:
        if i[0] == None:
            print('nothing')
        elif i[0] not in list:
            list.append(i[0])
            strval = strval + f', {i[0]}'
    listnum = strval
    return listnum
#if __name__ == "__main__":
    #create_database()
    #create_table()
    #ProjectCommands.add_data('Azure','Microsoft','Daniel')
    #delete_project('Azure')
    #delete_product('Azure','Microsoft')
    #delete_table()
