import mysql.connector as mysql
from sql_init import ProjectDB

def init():
    global mydb
    mydb=ProjectDB()
    global mycursor
    mycursor = mydb.cursor

def create_table():
     mycursor.execute("CREATE TABLE underlings (id INT AUTO_INCREMENT PRIMARY KEY, project VARCHAR(255), underling VARCHAR(255), underlingemail VARCHAR(255));")
     mydb.connection.commit()

def delete_table():
     mycursor.execute("DROP TABLE underlings;")
     mydb.connection.commit()

def init_under():
    with open("config_sql", "r") as file:
        configs = file.readlines()
        file.close()
    with open("sqlpassword", "r") as file:
            sqlpassword = file.read().strip()
            file.close()
    conn = mysql.connect(host='54.78.230.206', user='root', password='my_secret_password', database='projects')
    mycursor = conn.cursor()
    table_exists = False

    mycursor.execute("SHOW TABLES")
    for j in mycursor:
        print(j)
        if 'underlings' in j:
            table_exists = True
            print("underlings Table found")

    if table_exists == False:
        mycursor.execute("CREATE TABLE underlings (id INT AUTO_INCREMENT PRIMARY KEY, project VARCHAR(255), underling VARCHAR(255), underlingemail VARCHAR(255));")
        print("Table created")
        print("-----------------------------------------------")
    conn.commit()
    conn.close()
    init()
    return

def add_underling(project,underling,underlingemail):
    mycursor.execute(f"INSERT INTO underlings (project, underling, underlingemail) VALUES ('{project}','{underling}','{underlingemail}');")
    mydb.connection.commit()

def delete_project_underling(project):
    mycursor.execute(f"DELETE FROM underlings WHERE project = '{project}';")
    mydb.connection.commit()

def delete_underling(project, underling):
    mycursor.execute(f"DELETE FROM underlings WHERE project = '{project}' AND underling = '{underling}';")
    mydb.connection.commit()

def get_underling_email(project):
    mycursor.execute(f"SELECT underlingemail FROM underlings WHERE project='{project}';")
    data = mycursor.fetchall()
    list = []
    for i in data:
        if i[0] not in list:
            list.append(i[0])
    return list
def get_underlings_from_projects(project):
    mycursor.execute(f"SELECT underling FROM underlings WHERE project = '{project}';")
    data = mycursor.fetchall()
    list = []
    strval = ''
    for i in data:
        list.append(i[0])
        strval = strval + f', {i[0]}'
    listnum = [strval]
    return listnum
#if __name__ == "__main__":
    create_table()
    #delete_table()
    #add_data('Azure','George','George@jungle.com')
    #add_data('Azure','Lewis','Lewis@thenews.com')
    #add_data('AWS','Jonathan','Jonathan@dontknow.com')
    #add_data('AWS','Abdulaleem','Abdulaleem@hishouse.com')
    #print(get_underling_email('Azure'))
    #print(get_underling_email('AWS'))
